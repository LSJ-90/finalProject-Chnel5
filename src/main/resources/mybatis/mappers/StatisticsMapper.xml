<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hoge.mapper.StatisticsMapper">
  

	
  <!-- List<LabelDataDto> getRegisterCountPerDayDto(); -->
  <select id="getRegisterCountPerDayDto" resultType="com.hoge.dto.LabelDataDto">
		  SELECT 
		  		SUBSTR(B.TODAY,-4) AS label, 
		  		NVL(SUM(a.NEW_USERS), 0) as data
		FROM (SELECT TO_CHAR(USER_REGISTERED_DATE, 'YYYYMMDD') AS REGISTER_DATE,
		COUNT(*) AS NEW_USERS
		FROM TB_FINAL_USERS
		WHERE USER_REGISTERED_DATE >= TO_CHAR (SYSDATE-10, 'YYYYMMDD')
		AND USER_REGISTERED_DATE &lt; TO_CHAR(SYSDATE, 'YYYYMMDD')
		GROUP BY TO_CHAR(USER_REGISTERED_DATE, 'YYYYMMDD')) A
		, (SELECT
		TO_CHAR (FIRST_DAY + LEVEL -1, 'YYYYMMDD') TODAY
		FROM (SELECT TRUNC(SYSDATE - 10) FIRST_DAY FROM DUAL)
		CONNECT BY FIRST_DAY + LEVEL - 1 &lt;= TRUNC(SYSDATE)
		) B
		WHERE B.TODAY = A.REGISTER_DATE(+)
		GROUP BY B.TODAY
		ORDER BY B.TODAY
  </select>
  
  
  
  <!-- List<LabelDataDto> getSalesPerDayByHostNo(int no)-->
  <select id="getSalesPerDayByHostNo" parameterType="int" resultType="com.hoge.dto.LabelDataDto">
		   
      SELECT SUBSTR(B.TODAY,-4) AS label, NVL(SUM(a.TRANSACTION_AMOUNT), 0) as data
		FROM (SELECT TO_CHAR(TRANSACTION_DATE, 'YYYYMMDD') AS TRANSACTION_DATE,
		SUM(TRANSACTION_AMOUNT) AS TRANSACTION_AMOUNT
		FROM TB_FINAL_HOST_TRANSACTIONS
		WHERE TRANSACTION_DATE >= TO_CHAR (SYSDATE-20, 'YYYYMMDD')
		AND HOST_NO = #{no}
		AND TRANSACTION_DATE &lt; TO_CHAR(SYSDATE, 'YYYYMMDD')
        AND TRANSACTION_TYPE=1
		GROUP BY TO_CHAR(TRANSACTION_DATE, 'YYYYMMDD')) A
		, (SELECT
		TO_CHAR (FIRST_DAY + LEVEL -1, 'YYYYMMDD') TODAY
		FROM (SELECT TRUNC(SYSDATE - 20) FIRST_DAY FROM DUAL)
		CONNECT BY FIRST_DAY + LEVEL - 1 &lt;= TRUNC(SYSDATE)
		) B
		WHERE B.TODAY = A.TRANSACTION_DATE(+)
		GROUP BY B.TODAY
		ORDER BY B.TODAY
    
    
  </select>
  
  <!-- List<LabelDataDto> getTransactionAmountPerDay();-->
  <select id="getTransactionAmountPerDay" parameterType="int" resultType="com.hoge.dto.LabelDataDto">
		   
     SELECT SUBSTR(B.TODAY,-4) AS label, NVL(SUM(a.TRANSACTION_AMOUNT), 0) as data
		FROM (SELECT TO_CHAR(TRANSACTION_DATE, 'YYYYMMDD') AS TRANSACTION_DATE,
		SUM(TRANSACTION_AMOUNT) AS TRANSACTION_AMOUNT
		FROM TB_FINAL_TRANSACTIONS
		WHERE TRANSACTION_DATE >= TO_CHAR (SYSDATE-10, 'YYYYMMDD')
		AND TRANSACTION_DATE &lt; TO_CHAR(SYSDATE, 'YYYYMMDD')
        AND TRANSACTION_TYPE=1
		GROUP BY TO_CHAR(TRANSACTION_DATE, 'YYYYMMDD')) A
		, (SELECT
		TO_CHAR (FIRST_DAY + LEVEL -1, 'YYYYMMDD') TODAY
		FROM (SELECT TRUNC(SYSDATE - 10) FIRST_DAY FROM DUAL)
		CONNECT BY FIRST_DAY + LEVEL - 1 &lt;= TRUNC(SYSDATE)
		) B
		WHERE B.TODAY = A.TRANSACTION_DATE(+)
		GROUP BY B.TODAY
		ORDER BY B.TODAY
    
    
  </select>
  
  
  <!-- List<LabelDataDto> getProfitAmountPerMonth();-->
  <select id="getProfitAmountPerMonth" parameterType="int" resultType="com.hoge.dto.LabelDataDto">
		   
      SELECT SUBSTR(B.TODAY,-5) AS label, NVL(SUM(a.TRANSACTION_AMOUNT - C.TRANSACTION_WITHDRAWAL_AMOUNT), 0) as data
		FROM (SELECT TO_CHAR(TRANSACTION_DATE, 'YYYY/MM') AS TRANSACTION_DATE,
		SUM(TRANSACTION_AMOUNT) AS TRANSACTION_AMOUNT
		FROM TB_FINAL_TRANSACTIONS
		WHERE TO_CHAR(TRANSACTION_DATE, 'YYYY/MM') &lt;= TO_CHAR(SYSDATE, 'YYYY/MM')
        AND TRANSACTION_TYPE=1
		GROUP BY TO_CHAR(TRANSACTION_DATE, 'YYYY/MM')) A
		, (SELECT TO_CHAR(TRANSACTION_DATE, 'YYYY/MM') AS TRANSACTION_DATE,
		SUM(TRANSACTION_AMOUNT) AS TRANSACTION_WITHDRAWAL_AMOUNT
		FROM TB_FINAL_TRANSACTIONS
		WHERE TO_CHAR(TRANSACTION_DATE, 'YYYY/MM') &lt;= TO_CHAR(SYSDATE, 'YYYY/MM')
        AND TRANSACTION_TYPE IN (2,3)
		GROUP BY TO_CHAR(TRANSACTION_DATE, 'YYYY/MM')) C
        ,(SELECT
		TO_CHAR (FIRST_DAY + LEVEL -1, 'YYYY/MM') TODAY
		FROM (SELECT TRUNC(SYSDATE - 360) FIRST_DAY FROM DUAL)
		CONNECT BY FIRST_DAY + LEVEL - 1 &lt;= TRUNC(SYSDATE)
        GROUP BY TO_CHAR (FIRST_DAY + LEVEL -1, 'YYYY/MM')
        ORDER BY TODAY ASC
		) B
		WHERE B.TODAY = A.TRANSACTION_DATE(+)
		GROUP BY B.TODAY
		ORDER BY B.TODAy
    
  </select>
  
  

</mapper>